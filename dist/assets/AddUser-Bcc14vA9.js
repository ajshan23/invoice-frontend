import{r as t,i as J,j as e,k as K,P as h,b as Q,u as V,f as X,T as Y,e as C}from"./index-hhKMM5af.js";import{P as Z}from"./PageTitle-B1T6w3pI.js";import{S as z,b as N}from"./authConstant-D7ccvCuz.js";import{C as ee,a as se}from"./Card-CIyWpKf_.js";import{F as ae}from"./Form-B7eVZYZT.js";import{R as te,C as re}from"./Row-D46S1-Yf.js";import{F as p,a as f}from"./FormLabel-CdJuH_qT.js";import{F as g}from"./FormControl-Bl8iU_n-.js";import{B as T}from"./Button-CwuV16Mp.js";import"./CardHeaderContext-NYcVvM35.js";import"./divWithClassName-IzdvHqeb.js";import"./FormCheck-CULgSEX3.js";import"./FormContext-DUKgKx37.js";import"./ElementChildren-EnF4-W8v.js";import"./Button-Ccp68HYs.js";h.string,h.bool,h.bool,h.bool,h.bool;const L=t.forwardRef(({bsPrefix:n,className:x,fluid:i=!1,rounded:c=!1,roundedCircle:a=!1,thumbnail:u=!1,...w},d)=>(n=J(n,"img"),e.jsx("img",{ref:d,...w,className:K(x,i&&`${n}-fluid`,c&&"rounded",a&&"rounded-circle",u&&`${n}-thumbnail`)})));L.displayName="Image";const be=()=>{const{user:n,isAdmin:x}=Q(),i=V(),{id:c}=X(),a=!!c,[u,w]=t.useState(""),[d,E]=t.useState(""),[m,D]=t.useState(""),[S,F]=t.useState("staff"),[U,P]=t.useState(null),[k,y]=t.useState(null),[M,j]=t.useState(!1),[q,H]=t.useState(""),[$,R]=t.useState(!1),[I,A]=t.useState(a);t.useEffect(()=>{x()||i("/dashboard")},[x,i]),t.useEffect(()=>{a&&(async()=>{A(!0);try{const r=await fetch(`${N}/user/${c}`,{headers:{Authorization:`Bearer ${n.token}`}}),l=await r.json();if(r.ok&&l.success){const{name:b,email:v,role:_,signature:B}=l.data;w(b),E(v),F(_),B&&y(B)}else throw new Error(l.error||"Failed to fetch user")}catch(r){console.error("Error fetching user:",r),o(r.message||"Failed to fetch user."),i("/users")}finally{A(!1)}})()},[c,a,n.token,i]);const o=s=>{H(s),j(!0),setTimeout(()=>j(!1),3e3)},O=s=>{const r=s.target.files[0];if(r){P(r);const l=new FileReader;l.onloadend=()=>{y(l.result)},l.readAsDataURL(r)}},G=()=>{P(null),y(null)},W=async()=>{if(j(!1),!u.trim()){o("Name is required."),window.scrollTo({top:0,behavior:"smooth"});return}if(!d.trim()){o("Email is required."),window.scrollTo({top:0,behavior:"smooth"});return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d)){o("Please enter a valid email."),window.scrollTo({top:0,behavior:"smooth"});return}if(!a&&!m.trim()){o("Password is required for new users."),window.scrollTo({top:0,behavior:"smooth"});return}if(m&&m.length<6){o("Password must be at least 6 characters."),window.scrollTo({top:0,behavior:"smooth"});return}if(!["admin","staff"].includes(S)){o("Please select a valid role."),window.scrollTo({top:0,behavior:"smooth"});return}R(!0);try{const s=new FormData;s.append("name",u),s.append("email",d),s.append("role",S),m&&s.append("password",m),U&&s.append("signature",U);const r=a?`${N}/user/${c}`:`${N}/user/register`,b=await fetch(r,{method:a?"PUT":"POST",headers:{Authorization:`Bearer ${n.token}`},body:s}),v=await b.json();if(b.ok&&v.success)o(a?"User updated successfully!":"User created successfully!"),setTimeout(()=>i("/users"),1e3);else throw new Error(v.error||"Failed to save user")}catch(s){console.log(s),console.error(`Error ${a?"updating":"creating"} user:`,s),o(s.message||`Failed to ${a?"update":"create"} user.`),window.scrollTo({top:0,behavior:"smooth"})}finally{R(!1)}};return I?e.jsx("div",{className:"text-center mt-5",children:e.jsx(z,{animation:"border"})}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{position:"top-end",className:"p-3",children:e.jsxs(C,{onClose:()=>j(!1),show:M,delay:3e3,autohide:!0,bg:"white",children:[e.jsx(C.Header,{children:e.jsx("strong",{className:"me-auto",children:"Notification"})}),e.jsx(C.Body,{children:q})]})}),e.jsx(Z,{title:a?"Edit User":"Add User"}),e.jsx(ee,{children:e.jsxs(se,{children:[e.jsxs("h4",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"#0355a4",textShadow:"1px 1px 3px rgba(0, 0, 0, 0.2)",letterSpacing:"1px",position:"relative",display:"inline-block",marginBottom:"20px"},children:[a?"Edit User":"Add New User",e.jsx("span",{style:{content:'""',position:"absolute",left:0,bottom:"-5px",width:"50%",height:"3px",background:"linear-gradient(to right, #0355a4, transparent)"}})]}),e.jsxs(ae,{children:[e.jsx(te,{children:e.jsxs(re,{lg:12,children:[e.jsxs(p,{className:"mb-3",children:[e.jsx(f,{children:"Name *"}),e.jsx(g,{placeholder:"Enter full name",value:u,onChange:s=>w(s.target.value)})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(f,{children:"Email *"}),e.jsx(g,{type:"email",placeholder:"Enter email address",value:d,onChange:s=>E(s.target.value)})]}),e.jsxs(p,{className:"mb-3",children:[e.jsxs(f,{children:["Password ",a?"(Optional)":"*"]}),e.jsx(g,{type:"password",placeholder:a?"Enter new password (leave blank to keep current)":"Enter password (minimum 6 characters)",value:m,onChange:s=>D(s.target.value)})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(f,{children:"Role *"}),e.jsxs(g,{as:"select",value:S,onChange:s=>F(s.target.value),children:[e.jsx("option",{value:"staff",children:"Staff"}),e.jsx("option",{value:"admin",children:"Admin"})]})]}),e.jsxs(p,{className:"mb-3",children:[e.jsx(f,{children:"Signature"}),e.jsx(g,{type:"file",accept:"image/*",onChange:O}),k&&e.jsxs("div",{className:"mt-2",children:[e.jsx(L,{src:k,alt:"Signature preview",thumbnail:!0,style:{maxHeight:"100px"}}),e.jsx(T,{variant:"danger",size:"sm",className:"mt-2",onClick:G,children:"Remove Signature"})]})]})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:10},children:[e.jsx(T,{variant:"secondary",onClick:()=>i("/users"),className:"mt-3",children:"Cancel"}),e.jsx(T,{variant:"success",onClick:W,className:"mt-3",disabled:$,children:$?e.jsxs(e.Fragment,{children:[e.jsx(z,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true",className:"me-2"}),a?"Updating...":"Creating..."]}):a?"Update User":"Create User"})]})]})]})})]})};export{be as default};
