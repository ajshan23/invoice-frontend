import{b as te,r as m,u as ae,j as e,T as se,e as q}from"./index-CQD1z6Fx.js";import{l as re}from"./cropper-CITzz1RM.js";/* empty css                      */import{P as ne}from"./PageTitle-CtZGw2bx.js";import{S as oe,b as ie}from"./authConstant-Cc9JzxD5.js";import{C as F,a as I}from"./Card--fiRGSee.js";import{F as n}from"./Form-D_tiZ0-p.js";import{R as v,C as d}from"./Row-DR6tWxXV.js";import{F as c}from"./FormControl-B161gUqv.js";import{B as p}from"./Button-C4dcH4PN.js";import"./CardHeaderContext-CLFReu40.js";import"./divWithClassName-DI2ioJPZ.js";import"./FormCheck-fxkujzDx.js";import"./FormContext-jf0KNw1i.js";import"./ElementChildren-CTEE3YrK.js";import"./FormLabel-Dy83DiRD.js";import"./Button-BXfs0ALN.js";const Se=()=>{const{user:P}=te(),[b,D]=m.useState(""),[C,G]=m.useState(""),[f,B]=m.useState(""),[l,g]=m.useState([]),[u,N]=m.useState([""]),[U,y]=m.useState(!1),[z,M]=m.useState(""),[L,R]=m.useState(!1),Q=ae(),E=m.useRef({}),[w,k]=m.useState({}),_=()=>{const a={name:"",price:0,quantity:1,image:"",subItems:[]};g([...l,a])},O=a=>{const t=l.filter((s,r)=>r!==a);g(t)},j=(a,t,s)=>{const r=[...l];if(r[a][t]=s,g(r),t==="image"){const o={...w};delete o[a],k(o)}},$=a=>{const t=[...l];t[a].subItems.push({name:"",price:0,quantity:1}),g(t)},H=(a,t)=>{const s=[...l];s[a].subItems=s[a].subItems.filter((r,o)=>o!==t),g(s)},S=(a,t,s,r)=>{const o=[...l];o[a].subItems[t][s]=r,g(o)},W=(a,t)=>{const s=t.target.files[0];if(s){const r=new FileReader;r.onload=()=>{j(a,"image",r.result)},r.readAsDataURL(s)}},J=(a,t)=>{t&&(E.current[a]=t)},K=a=>{const t=E.current[a];if(t){const s=t.getCroppedCanvas({width:150,height:300});if(s){const r=s.toDataURL();j(a,"image",r),k({...w,[a]:!0})}}},V=()=>{N([...u,""])},X=a=>{const t=u.filter((s,r)=>r!==a);N(t)},Y=(a,t)=>{const s=[...u];s[a]=t,N(s)},h=a=>{M(a),y(!0),setTimeout(()=>y(!1),3e3)},Z=async()=>{if(y(!1),!b||!C||!f){h("Company Name, Date, and Invoice Number are required."),window.scrollTo({top:0,behavior:"smooth"});return}if(l.length===0){h("At least one main item is required."),window.scrollTo({top:0,behavior:"smooth"});return}for(let a=0;a<l.length;a++){const t=l[a];if(!t.name||!t.price||!t.quantity){h("All main item fields (Name, Price, Quantity) are required."),window.scrollTo({top:0,behavior:"smooth"});return}for(let s=0;s<t.subItems.length;s++){const r=t.subItems[s];if(!r.name||!r.price||!r.quantity){h("All sub-item fields (Name, Price, Quantity) are required."),window.scrollTo({top:0,behavior:"smooth"});return}}}if(u.length===0||u.some(a=>!a.trim())){h("At least one term is required."),window.scrollTo({top:0,behavior:"smooth"});return}R(!0);try{const a={companyName:b,date:C,quotationNumber:f,items:l.map(i=>({name:i.name,price:parseFloat(i.price),quantity:parseInt(i.quantity),image:i.image,subItems:i.subItems.map(T=>({name:T.name,price:parseFloat(T.price),quantity:parseInt(T.quantity)}))})),terms:u.filter(i=>i.trim())},t=await fetch(`${ie}/quotation`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${P.token}`},body:JSON.stringify(a)});if(!t.ok)throw new Error("Failed to generate PDF");const s=await t.json();if(!s.pdf)throw new Error("No PDF data found in response");const r=atob(s.pdf),o=new Uint8Array(r.length);for(let i=0;i<r.length;i++)o[i]=r.charCodeAt(i);const ee=new Blob([o],{type:"application/pdf"}),A=window.URL.createObjectURL(ee),x=document.createElement("a");x.href=A,x.download=`ISC Quotation_${b}_${f}.pdf`,document.body.appendChild(x),x.click(),x.remove(),window.URL.revokeObjectURL(A),h("PDF generated and downloaded successfully!"),Q("/quotation")}catch(a){console.error("Error generating PDF:",a),h("Failed to generate PDF. Please try again."),window.scrollTo({top:0,behavior:"smooth"})}finally{R(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(se,{position:"top-end",className:"p-3",children:e.jsxs(q,{onClose:()=>y(!1),show:U,delay:3e3,autohide:!0,children:[e.jsx(q.Header,{children:e.jsx("strong",{className:"me-auto",children:"Notification"})}),e.jsx(q.Body,{children:z})]})}),e.jsx(ne,{title:"Create Quotation"}),e.jsx(F,{children:e.jsxs(I,{children:[e.jsxs("h4",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"#0355a4",textShadow:"1px 1px 3px rgba(0, 0, 0, 0.2)",letterSpacing:"1px",position:"relative",display:"inline-block",marginBottom:"20px"},children:["Create Invoice",e.jsx("span",{style:{content:'""',position:"absolute",left:0,bottom:"-5px",width:"50%",height:"3px",background:"linear-gradient(to right, #0355a4, transparent)"}})]}),e.jsxs(n,{children:[e.jsx(v,{children:e.jsxs(d,{lg:12,children:[e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Company Name *"}),e.jsx(c,{placeholder:"Enter company name",value:b,onChange:a=>D(a.target.value)})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Date *"}),e.jsx(c,{type:"date",value:C,onChange:a=>G(a.target.value),required:!0})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Invoice Number *"}),e.jsx(c,{placeholder:"Enter invoice number",value:f,onChange:a=>B(a.target.value)})]})]})}),l.map((a,t)=>e.jsx(F,{className:"mb-3",children:e.jsxs(I,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{children:["Main Item ",t+1]}),e.jsx(p,{variant:"danger",size:"sm",onClick:()=>O(t),children:"Remove"})]}),e.jsxs(v,{children:[e.jsxs(d,{lg:6,children:[e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Item Name *"}),e.jsx(c,{placeholder:"Enter item name",value:a.name,onChange:s=>j(t,"name",s.target.value)})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Price *"}),e.jsx(c,{type:"number",placeholder:"Enter price",value:a.price,onChange:s=>j(t,"price",s.target.value)})]}),e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Quantity *"}),e.jsx(c,{type:"number",placeholder:"Enter quantity",value:a.quantity,onChange:s=>j(t,"quantity",s.target.value)})]})]}),e.jsxs(d,{lg:6,children:[e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Item Image (Optional)"}),e.jsx(c,{type:"file",accept:"image/*",onChange:s=>W(t,s)})]}),a.image&&e.jsxs(e.Fragment,{children:[e.jsx(re,{src:a.image,style:{height:200,width:"100%"},aspectRatio:1/2,guides:!0,viewMode:1,minCropBoxWidth:150,minCropBoxHeight:300,onInitialized:s=>J(t,s)}),e.jsxs("div",{className:"mt-2 mb-2 d-flex justify-content-between align-items-center",children:[e.jsx("small",{className:"text-muted",children:"Cropping to 150x300 aspect ratio"}),w[t]&&e.jsx("span",{className:"text-success",children:"âœ“ Image cropped"})]}),e.jsx(p,{variant:"info",onClick:()=>K(t),className:"mt-2",children:"Apply Crop"})]})]})]}),a.subItems.map((s,r)=>e.jsxs(v,{className:"mt-3",children:[e.jsx(d,{lg:4,children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Sub-Item Name *"}),e.jsx(c,{placeholder:"Enter sub-item name",value:s.name,onChange:o=>S(t,r,"name",o.target.value)})]})}),e.jsx(d,{lg:4,children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Price *"}),e.jsx(c,{type:"number",placeholder:"Enter price",value:s.price,onChange:o=>S(t,r,"price",o.target.value)})]})}),e.jsx(d,{lg:4,children:e.jsxs(n.Group,{className:"mb-3",children:[e.jsx(n.Label,{children:"Quantity *"}),e.jsx(c,{type:"number",placeholder:"Enter quantity",value:s.quantity,onChange:o=>S(t,r,"quantity",o.target.value)})]})}),e.jsx(d,{lg:12,className:"d-flex justify-content-end",children:e.jsx(p,{variant:"danger",size:"sm",onClick:()=>H(t,r),children:"Remove Sub-Item"})})]},r)),e.jsx(p,{variant:"secondary",onClick:()=>$(t),className:"mt-2",children:"Add Sub-Item"})]})},t)),e.jsx(F,{className:"mb-3",children:e.jsxs(I,{children:[e.jsx("h5",{children:"Terms and Conditions"}),u.map((a,t)=>e.jsxs(v,{className:"mb-3",children:[e.jsx(d,{lg:12,children:e.jsxs(n.Group,{children:[e.jsxs(n.Label,{children:["Term ",t+1," *"]}),e.jsx(c,{as:"textarea",rows:3,placeholder:"Enter term",value:a,onChange:s=>Y(t,s.target.value)})]})}),e.jsx(d,{lg:12,className:"d-flex justify-content-end",children:e.jsx(p,{variant:"danger",size:"sm",onClick:()=>X(t),children:"Remove Term"})})]},t)),e.jsx(p,{variant:"secondary",onClick:V,className:"mt-2",children:"Add Term"})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:10},children:[e.jsx(p,{variant:"primary",onClick:_,className:"mt-3",children:"Add Main Item"}),e.jsx(p,{variant:"success",onClick:Z,className:"mt-3",disabled:L,children:L?e.jsxs(e.Fragment,{children:[e.jsx(oe,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true",className:"me-2"}),"Submitting..."]}):"Submit"})]})]})]})})]})};export{Se as default};
