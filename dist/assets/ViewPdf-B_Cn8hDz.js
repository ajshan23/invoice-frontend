import{f as q,u as U,r as h,j as e,R as k}from"./index-BDB4q5H4.js";import{a as g}from"./index-C88pvD_q.js";import{C as m}from"./Container-BgJdnPuZ.js";import{S as G}from"./Spinner-CavDfVX6.js";import{A as y}from"./Alert-6EsTWlDT.js";import{C as r}from"./Card-i0dum0de.js";import{B as v}from"./Button-BMFIQuqA.js";import{T as V}from"./Table-BQazxHsT.js";import{B as a}from"./ListGroup-hYJxMLPr.js";import"./hook-nKx0Scw7.js";import"./extends-CF3RwP-h.js";import"./divWithClassName-Cje9adg3.js";import"./Anchor-CV3PsB9I.js";import"./useEventCallback-B-mETKOe.js";import"./Button-BvulfwIl.js";import"./CardHeaderContext-BJhvqqIk.js";import"./Nav-C5s07W8n.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-CS3cqyQZ.js";import"./useMergedRefs-Bw5jdVLL.js";import"./NavItem-BREyq39t.js";const de=()=>{const{id:d}=q(),N=U(),[x,b]=h.useState(null),[w,B]=h.useState(!0),[j,p]=h.useState("");h.useEffect(()=>{(async()=>{try{const n=await g.get(`http://185.199.53.88/api/invoice/${d}`);n.status===200&&b(n.data.data)}catch(n){console.error("Error fetching invoice:",n),p("Failed to fetch invoice details. Please try again.")}finally{B(!1)}})()},[d]);const C=async()=>{var t,n;try{const s=await g.get(`http://185.199.53.88/api/invoice/${d}/pdf`);if(!s.data.success)throw new Error(s.data.error||"Failed to generate PDF");const i=s.data.pdf,c=atob(i),u=new Uint8Array(c.length);for(let l=0;l<c.length;l++)u[l]=c.charCodeAt(l);const R=new Blob([u],{type:"application/pdf"}),f=window.URL.createObjectURL(R),o=document.createElement("a");o.href=f,o.download=`quotation_${x.invoiceNumber}.pdf`,document.body.appendChild(o),o.click(),o.remove(),window.URL.revokeObjectURL(f)}catch(s){console.error("Error generating PDF:",s),p(((n=(t=s.response)==null?void 0:t.data)==null?void 0:n.error)||"Failed to generate PDF. Please try again.")}},T=()=>{N(`/invoice/edit/${d}`)};if(w)return e.jsx(m,{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx(G,{animation:"border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})});if(j)return e.jsx(m,{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx(y,{variant:"danger",children:j})});if(!x)return e.jsx(m,{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx(y,{variant:"warning",children:"No invoice found."})});const{companyName:A,date:P,invoiceNumber:$,items:E,terms:D,totalPrice:F,VATAmount:I,finalAmount:L}=x,S=new Date(P).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});return e.jsx(m,{className:"my-5",children:e.jsxs(r,{children:[e.jsx(r.Header,{as:"h1",className:"text-center",children:"Invoice Details"}),e.jsxs(r.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-end mb-4",children:[e.jsx(v,{variant:"primary",onClick:T,className:"me-2",children:"Edit Invoice"}),e.jsx(v,{variant:"success",onClick:C,children:"Generate PDF"})]}),e.jsx(r,{className:"mb-4",children:e.jsxs(r.Body,{children:[e.jsxs(r.Title,{children:["Company: ",A]}),e.jsxs(r.Text,{children:[e.jsx("strong",{children:"Invoice Number:"})," ",$,e.jsx("br",{}),e.jsx("strong",{children:"Date:"})," ",S]})]})}),e.jsx(r,{className:"mb-4",children:e.jsxs(r.Body,{children:[e.jsx(r.Title,{children:"Items"}),e.jsxs(V,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Image"})]})}),e.jsx("tbody",{children:E.map((t,n)=>{const s=1+t.subItems.length;return e.jsxs(k.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:t.name}),e.jsx("td",{className:"text-center",children:t.quantity}),e.jsxs("td",{className:"text-end",children:["$",t.price]}),e.jsxs("td",{className:"text-end",children:["$",t.quantity*t.price]}),e.jsx("td",{rowSpan:s,style:{textAlign:"center"},children:t.image&&e.jsx("img",{src:t.image,alt:t.name,style:{width:"80px",height:"auto"}})})]}),t.subItems.map((i,c)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{paddingLeft:"30px"},children:[String.fromCharCode(97+c),"."," ",i.name]}),e.jsx("td",{className:"text-center",children:i.quantity}),e.jsxs("td",{className:"text-end",children:["$",i.price]}),e.jsxs("td",{className:"text-end",children:["$",i.quantity*i.price]})]},i._id))]},n)})})]})]})}),e.jsx(r,{className:"mb-4",children:e.jsxs(r.Body,{children:[e.jsx(r.Title,{children:"Totals"}),e.jsxs(a,{variant:"flush",children:[e.jsxs(a.Item,{children:[e.jsx("strong",{children:"Total Price:"})," $",F]}),e.jsxs(a.Item,{children:[e.jsx("strong",{children:"VAT Amount:"})," $",I]}),e.jsxs(a.Item,{children:[e.jsx("strong",{children:"Final Amount:"})," $",L]})]})]})}),e.jsx(r,{children:e.jsxs(r.Body,{children:[e.jsx(r.Title,{children:"Terms and Conditions"}),e.jsx(a,{variant:"flush",children:D.map((t,n)=>e.jsx(a.Item,{children:t},n))})]})})]})]})})};export{de as default};
