import{f as q,u as _,r as d,j as e,R as V}from"./index-Bea3LdGt.js";import{a as b}from"./index-C88pvD_q.js";import{r as i}from"./riyal_icon-CI4jK9IE.js";import{b as P}from"./authConstant-CsT3Fd4n.js";import{C as j}from"./Container-jhcSp3Gk.js";import{S as F}from"./Spinner-BDg-ViH2.js";import{A as p}from"./Alert-yVOfX2Uo.js";import{B as u}from"./Button-DS4weSLp.js";import{C as r}from"./Card-DMzlgkqn.js";import{T as O}from"./Table-C_ImA-1-.js";import{B as o}from"./ListGroup-Bqoi72zl.js";import"./hook-DLcoLYPa.js";import"./extends-CF3RwP-h.js";import"./divWithClassName-ClTleM2P.js";import"./Anchor-Cfm-EKnE.js";import"./useEventCallback-BLVNoATc.js";import"./Button-D3o7_G4W.js";import"./CardHeaderContext-fdK9POSy.js";import"./Nav-DZDnJSA5.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-lvwnZZZs.js";import"./useMergedRefs-Bv_kR_LQ.js";import"./NavItem-Baf8TD0W.js";const xe=()=>{const{id:a}=q(),D=_(),[h,C]=d.useState(null),[B,I]=d.useState(!0),[y,f]=d.useState(""),[m,v]=d.useState(!1);d.useEffect(()=>{(async()=>{try{console.log("Fetching invoice with ID:",a);const s=await b.get(`${P}/invoice/${a}`);console.log("Fetch response:",s.data),s.status===200&&C(s.data.data)}catch(s){console.error("Error fetching invoice:",s),f("Failed to fetch invoice details. Please try again.")}finally{I(!1)}})()},[a]);const w=async()=>{v(!0),f(""),console.log("Starting PDF generation for invoice ID:",a);try{const t=await b.get(`${P}/invoice/${a}/pdf`,{timeout:3e4});if(console.log("PDF response:",t.data),!t.data.success)throw new Error(t.data.error||"Failed to generate PDF");const s=t.data.pdf;if(!s)throw new Error("No PDF data received from server");const c=atob(s),n=new Uint8Array(c.length);for(let x=0;x<c.length;x++)n[x]=c.charCodeAt(x);const g=new Blob([n],{type:"application/pdf"}),N=window.URL.createObjectURL(g),l=document.createElement("a");l.href=N,l.download=`ISC Quotation_${h.companyName}_${h.invoiceNumber}.pdf`,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(N),console.log("PDF download initiated successfully")}catch(t){console.error("PDF generation error:",t),f(t.message||"Failed to generate PDF. Please try again.")}finally{v(!1),console.log("PDF loading state reset")}},T=()=>{D(`/invoice/edit/${a}`)};if(B)return e.jsx(j,{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx(F,{animation:"border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})});if(y&&!m)return e.jsx(j,{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsxs(p,{variant:"danger",children:[y,e.jsx(u,{variant:"link",onClick:w,children:"Retry"})]})});if(!h)return e.jsx(j,{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx(p,{variant:"warning",children:"No invoice found."})});const{companyName:A,date:S,invoiceNumber:L,items:E,terms:R,totalPrice:$,VATAmount:k,finalAmount:G}=h,U=new Date(S).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});return e.jsx(j,{className:"my-5",children:e.jsxs(r,{children:[e.jsx(r.Header,{as:"h1",className:"text-center",children:"Invoice Details"}),e.jsxs(r.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-end mb-4",children:[e.jsx(u,{variant:"primary",onClick:T,className:"me-2",children:"Edit Invoice"}),e.jsx(u,{variant:"success",onClick:w,disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(F,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"})," ","Generating PDF..."]}):"Generate PDF"})]}),m&&e.jsx(p,{variant:"info",className:"text-center",children:"Generating PDF, please wait..."}),e.jsx(r,{className:"mb-4",children:e.jsxs(r.Body,{children:[e.jsxs(r.Title,{children:["Company: ",A]}),e.jsxs(r.Text,{children:[e.jsx("strong",{children:"Invoice Number:"})," ",L,e.jsx("br",{}),e.jsx("strong",{children:"Date:"})," ",U]})]})}),e.jsx(r,{className:"mb-4",children:e.jsxs(r.Body,{children:[e.jsx(r.Title,{children:"Items"}),e.jsxs(O,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Image"})]})}),e.jsx("tbody",{children:E.map((t,s)=>{const c=1+t.subItems.length;return e.jsxs(V.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:t.name}),e.jsx("td",{className:"text-center",children:t.quantity}),e.jsxs("td",{className:"text-end flex flex-row",children:[e.jsx("img",{src:i,width:10,height:12}),t.price]}),e.jsxs("td",{className:"text-end flex flex-row",children:[e.jsx("img",{src:i,width:10,height:12}),t.quantity*t.price]}),e.jsx("td",{rowSpan:c,style:{textAlign:"center"},children:t.image&&e.jsx("img",{src:t.image,alt:t.name,style:{width:"80px",height:"auto"}})})]}),t.subItems.map((n,g)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{paddingLeft:"30px"},children:[String.fromCharCode(97+g),"."," ",n.name]}),e.jsx("td",{className:"text-center",children:n.quantity}),e.jsxs("td",{className:"text-end flex flex-row",children:[e.jsx("img",{src:i,width:10,height:12}),n.price]}),e.jsxs("td",{className:"text-end flex flex-row",children:[e.jsx("img",{src:i,width:10,height:12}),n.quantity*n.price]})]},n._id))]},s)})})]})]})}),e.jsx(r,{className:"mb-4",children:e.jsxs(r.Body,{children:[e.jsx(r.Title,{children:"Totals"}),e.jsxs(o,{variant:"flush",children:[e.jsxs(o.Item,{children:[e.jsx("strong",{children:"Total Price:"})," ",e.jsx("img",{src:i,width:10,height:12}),$]}),e.jsxs(o.Item,{children:[e.jsx("strong",{children:"VAT Amount:"})," ",e.jsx("img",{src:i,width:10,height:12}),k]}),e.jsxs(o.Item,{children:[e.jsx("strong",{children:"Final Amount:"})," ",e.jsx("img",{src:i,width:10,height:12}),G]})]})]})}),e.jsx(r,{children:e.jsxs(r.Body,{children:[e.jsx(r.Title,{children:"Terms and Conditions"}),e.jsx(o,{variant:"flush",children:R.map((t,s)=>e.jsx(o.Item,{children:t},s))})]})})]})]})})};export{xe as default};
