import{f as U,u as T,b as z,r as n,j as e}from"./index-CQD1z6Fx.js";import{a as b}from"./index-C88pvD_q.js";import{S as w,b as N}from"./authConstant-Cc9JzxD5.js";import{C as m}from"./Container-DnrcczuC.js";import{A as f}from"./Alert-CCTIxRAI.js";import{B as j}from"./Button-C4dcH4PN.js";import{C as s}from"./Card--fiRGSee.js";import{B as _}from"./Badge-CZdSZjdi.js";import{T as O}from"./Table-D0X8E4ck.js";import"./hook-BSaIOabk.js";import"./extends-CF3RwP-h.js";import"./divWithClassName-DI2ioJPZ.js";import"./Anchor-uhiCwYfp.js";import"./useEventCallback-CVZnaNmR.js";import"./Button-BXfs0ALN.js";import"./CardHeaderContext-CLFReu40.js";const ne=()=>{const{id:o}=U(),h=T(),{user:a}=z(),[d,D]=n.useState(null),[B,C]=n.useState(!0),[y,u]=n.useState(""),[c,p]=n.useState(!1);n.useEffect(()=>{a||h("/auth/login")},[a,h]),n.useEffect(()=>{const r=async()=>{try{const t=await b.get(`${N}/deliveries/${o}`,{headers:{Authorization:`Bearer ${a.token}`}});if(t.data.success)D(t.data.data);else throw new Error(t.data.error||"Failed to fetch delivery")}catch(t){console.error("Error fetching delivery:",t),u(t.message||"Failed to fetch delivery details.")}finally{C(!1)}};a&&a.token&&r()},[o,a]);const E=async()=>{p(!0),u("");try{const r=await b.get(`${N}/deliveries/download/${o}`,{headers:{Authorization:`Bearer ${a.token}`},timeout:3e4});if(console.log(r),!r.data.success)throw new Error(r.data.error||"Failed to generate PDF");const t=r.data.pdf;if(!t)throw new Error("No PDF data received from server");const x=atob(t),v=new Uint8Array(x.length);for(let l=0;l<x.length;l++)v[l]=x.charCodeAt(l);const G=new Blob([v],{type:"application/pdf"}),g=window.URL.createObjectURL(G),i=document.createElement("a");i.href=g,i.download=`Delivery_${d.companyName}_${d.deliveryNumber}.pdf`,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(g)}catch(r){console.error("PDF generation error:",r),u(r.message||"Failed to generate PDF. Please try again.")}finally{p(!1)}},F=()=>{h(`/delivery-note/edit/${o}`)};if(B)return e.jsx(m,{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx(w,{animation:"border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})});if(y&&!c)return e.jsx(m,{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsxs(f,{variant:"danger",children:[y,e.jsx(j,{variant:"link",onClick:()=>window.location.reload(),children:"Retry"})]})});if(!d)return e.jsx(m,{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx(f,{variant:"warning",children:"No delivery note found."})});const{companyName:P,date:k,deliveryNumber:L,items:A,receivedBy:q,createdAt:S}=d,$=new Date(k).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"}),R=new Date(S).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return e.jsx(m,{className:"my-5",children:e.jsxs(s,{children:[e.jsxs(s.Header,{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h1",{className:"mb-0",children:"Delivery Note"}),e.jsxs(_,{bg:"secondary",children:["#",L]})]}),e.jsxs(s.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-end gap-2 mb-4",children:[e.jsx(j,{variant:"primary",onClick:F,children:"Edit Delivery"}),e.jsx(j,{variant:"success",onClick:E,disabled:c,children:c?e.jsxs(e.Fragment,{children:[e.jsx(w,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"})," ","Generating PDF..."]}):"Download PDF"})]}),c&&e.jsx(f,{variant:"info",className:"text-center",children:"Generating PDF, please wait..."}),e.jsx(s,{className:"mb-4",children:e.jsx(s.Body,{children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("h5",{children:"Delivery To:"}),e.jsx("p",{className:"fs-5 fw-bold",children:P})]}),e.jsxs("div",{className:"col-md-6 text-md-end",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Delivery Date:"})," ",$]}),e.jsxs("p",{className:"text-muted small",children:["Created on: ",R]})]})]})})}),e.jsx(s,{className:"mb-4",children:e.jsxs(s.Body,{children:[e.jsx(s.Title,{children:"Items Delivered"}),e.jsxs(O,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{className:"table-dark",children:e.jsxs("tr",{children:[e.jsx("th",{children:"#"}),e.jsx("th",{children:"Description"}),e.jsx("th",{className:"text-center",children:"Quantity"})]})}),e.jsx("tbody",{children:A.map((r,t)=>e.jsxs("tr",{children:[e.jsx("td",{children:t+1}),e.jsx("td",{children:r.description}),e.jsx("td",{className:"text-center",children:r.quantity})]},t))})]})]})})]})]})})};export{ne as default};
