import{r as c,u as Z,j as e,T as _,e as T}from"./index-Dot2ZeBG.js";import{l as $}from"./cropper-DbF_Lt9q.js";/* empty css                      */import{C as q,a as F}from"./Card-CE-bOKUQ.js";import{F as o}from"./Form-B4AQbC1Q.js";import{R as y,C as p}from"./Row-DGVe-lpy.js";import{F as l}from"./FormControl-DD1QWrMe.js";import{B as j}from"./Button-S_Q-X6An.js";import{S as ee}from"./Spinner-9R7J-vyD.js";import"./CardHeaderContext-B89mYLHu.js";import"./divWithClassName-BNJOBz37.js";import"./FormCheck-wZJdYtBO.js";import"./FormContext-C-tsPoCN.js";import"./ElementChildren-BlH5HHkL.js";import"./FormLabel-8d7SyeDj.js";import"./Button-BBg956Hz.js";const xe=()=>{const[v,D]=c.useState(""),[w,G]=c.useState(""),[C,k]=c.useState(""),[m,x]=c.useState([]),[h,L]=c.useState([""]),[B,b]=c.useState(!1),[U,M]=c.useState(""),[E,I]=c.useState(!1),O=Z(),R=c.useRef({}),[f,P]=c.useState({}),Q=()=>{const a={name:"",price:0,quantity:1,image:"",subItems:[]};x([...m,a])},u=(a,t,s)=>{const r=[...m];if(r[a][t]=s,x(r),t==="image"){const n={...f};delete n[a],P(n)}},z=a=>{const t=[...m];t[a].subItems.push({name:"",price:0,quantity:1}),x(t)},N=(a,t,s,r)=>{const n=[...m];n[a].subItems[t][s]=r,x(n)},H=(a,t)=>{const s=t.target.files[0];if(s){const r=new FileReader;r.onload=()=>{u(a,"image",r.result)},r.readAsDataURL(s)}},W=(a,t)=>{t&&(R.current[a]=t)},J=a=>{const t=R.current[a];if(t){const s=t.getCroppedCanvas({width:150,height:300});if(s){const r=s.toDataURL();u(a,"image",r),P({...f,[a]:!0})}}},K=()=>{L([...h,""])},V=(a,t)=>{const s=[...h];s[a]=t,L(s)},d=a=>{M(a),b(!0),setTimeout(()=>b(!1),3e3)},X=async()=>{if(b(!1),!v||!w||!C){d("Company Name, Date, and Invoice Number are required."),window.scrollTo({top:0,behavior:"smooth"});return}if(m.length===0){d("At least one main item is required."),window.scrollTo({top:0,behavior:"smooth"});return}for(let a=0;a<m.length;a++){const t=m[a];if(!t.name||!t.price||!t.quantity){d("All main item fields (Name, Price, Quantity) are required."),window.scrollTo({top:0,behavior:"smooth"});return}if(!t.image||!f[a]){d("Please upload and crop an image for all main items."),window.scrollTo({top:0,behavior:"smooth"});return}for(let s=0;s<t.subItems.length;s++){const r=t.subItems[s];if(!r.name||!r.price||!r.quantity){d("All sub-item fields (Name, Price, Quantity) are required."),window.scrollTo({top:0,behavior:"smooth"});return}}}if(h.length===0||h.some(a=>!a.trim())){d("At least one term is required."),window.scrollTo({top:0,behavior:"smooth"});return}I(!0);try{const a={companyName:v,date:w,invoiceNumber:C,items:m.map(i=>({name:i.name,price:parseFloat(i.price),quantity:parseInt(i.quantity),image:i.image,subItems:i.subItems.map(S=>({name:S.name,price:parseFloat(S.price),quantity:parseInt(S.quantity)}))})),terms:h.filter(i=>i.trim())},t=await fetch("http://localhost:3005/api/invoice",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!t.ok)throw new Error("Failed to generate PDF");const s=await t.json();if(!s.pdf)throw new Error("No PDF data found in response");const r=atob(s.pdf),n=new Uint8Array(r.length);for(let i=0;i<r.length;i++)n[i]=r.charCodeAt(i);const Y=new Blob([n],{type:"application/pdf"}),A=window.URL.createObjectURL(Y),g=document.createElement("a");g.href=A,g.download="quotation.pdf",document.body.appendChild(g),g.click(),g.remove(),window.URL.revokeObjectURL(A),d("PDF generated and downloaded successfully!"),O("/pdf")}catch(a){console.error("Error generating PDF:",a),d("Failed to generate PDF. Please try again."),window.scrollTo({top:0,behavior:"smooth"})}finally{I(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(_,{position:"top-end",className:"p-3",children:e.jsxs(T,{onClose:()=>b(!1),show:B,delay:3e3,autohide:!0,children:[e.jsx(T.Header,{children:e.jsx("strong",{className:"me-auto",children:"Notification"})}),e.jsx(T.Body,{children:U})]})}),e.jsx(q,{children:e.jsxs(F,{children:[e.jsxs("h4",{style:{fontSize:"2.5rem",fontWeight:"bold",color:"#0355a4",textShadow:"1px 1px 3px rgba(0, 0, 0, 0.2)",letterSpacing:"1px",position:"relative",display:"inline-block",marginBottom:"20px"},children:["Create Invoice",e.jsx("span",{style:{content:'""',position:"absolute",left:0,bottom:"-5px",width:"50%",height:"3px",background:"linear-gradient(to right, #0355a4, transparent)"}})]}),e.jsxs(o,{children:[e.jsx(y,{children:e.jsxs(p,{lg:12,children:[e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Company Name *"}),e.jsx(l,{placeholder:"Enter company name",value:v,onChange:a=>D(a.target.value)})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Date *"}),e.jsx(l,{type:"date",value:w,onChange:a=>G(a.target.value),required:!0})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Invoice Number *"}),e.jsx(l,{placeholder:"Enter invoice number",value:C,onChange:a=>k(a.target.value)})]})]})}),m.map((a,t)=>e.jsx(q,{className:"mb-3",children:e.jsxs(F,{children:[e.jsxs("h5",{children:["Main Item ",t+1]}),e.jsxs(y,{children:[e.jsxs(p,{lg:6,children:[e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Item Name *"}),e.jsx(l,{placeholder:"Enter item name",value:a.name,onChange:s=>u(t,"name",s.target.value)})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Price *"}),e.jsx(l,{type:"number",placeholder:"Enter price",value:a.price,onChange:s=>u(t,"price",s.target.value)})]}),e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Quantity *"}),e.jsx(l,{type:"number",placeholder:"Enter quantity",value:a.quantity,onChange:s=>u(t,"quantity",s.target.value)})]})]}),e.jsxs(p,{lg:6,children:[e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Item Image *"}),e.jsx(l,{type:"file",accept:"image/*",onChange:s=>H(t,s)})]}),a.image&&e.jsxs(e.Fragment,{children:[e.jsx($,{src:a.image,style:{height:200,width:"100%"},aspectRatio:1/2,guides:!0,viewMode:1,minCropBoxWidth:150,minCropBoxHeight:300,onInitialized:s=>W(t,s)}),e.jsxs("div",{className:"mt-2 mb-2 d-flex justify-content-between align-items-center",children:[e.jsx("small",{className:"text-muted",children:"Cropping to 150x300 aspect ratio"}),f[t]&&e.jsx("span",{className:"text-success",children:"âœ“ Image cropped"})]}),e.jsx(j,{variant:"info",onClick:()=>J(t),className:"mt-2",children:"Apply Crop"})]})]})]}),a.subItems.map((s,r)=>e.jsxs(y,{className:"mt-3",children:[e.jsx(p,{lg:4,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Sub-Item Name *"}),e.jsx(l,{placeholder:"Enter sub-item name",value:s.name,onChange:n=>N(t,r,"name",n.target.value)})]})}),e.jsx(p,{lg:4,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Price *"}),e.jsx(l,{type:"number",placeholder:"Enter price",value:s.price,onChange:n=>N(t,r,"price",n.target.value)})]})}),e.jsx(p,{lg:4,children:e.jsxs(o.Group,{className:"mb-3",children:[e.jsx(o.Label,{children:"Quantity *"}),e.jsx(l,{type:"number",placeholder:"Enter quantity",value:s.quantity,onChange:n=>N(t,r,"quantity",n.target.value)})]})})]},r)),e.jsx(j,{variant:"secondary",onClick:()=>z(t),className:"mt-2",children:"Add Sub-Item"})]})},t)),e.jsx(q,{className:"mb-3",children:e.jsxs(F,{children:[e.jsx("h5",{children:"Terms and Conditions"}),h.map((a,t)=>e.jsx(y,{className:"mb-3",children:e.jsx(p,{lg:12,children:e.jsxs(o.Group,{children:[e.jsxs(o.Label,{children:["Term ",t+1," *"]}),e.jsx(l,{as:"textarea",rows:3,placeholder:"Enter term",value:a,onChange:s=>V(t,s.target.value)})]})})},t)),e.jsx(j,{variant:"secondary",onClick:K,className:"mt-2",children:"Add Term"})]})}),e.jsxs("div",{style:{display:"flex",flexDirection:"row",gap:10},children:[e.jsx(j,{variant:"primary",onClick:Q,className:"mt-3",children:"Add Main Item"}),e.jsx(j,{variant:"success",onClick:X,className:"mt-3",disabled:E,children:E?e.jsxs(e.Fragment,{children:[e.jsx(ee,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true",className:"me-2"}),"Submitting..."]}):"Submit"})]})]})]})})]})};export{xe as default};
