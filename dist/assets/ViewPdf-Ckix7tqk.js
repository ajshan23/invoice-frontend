import{f as k,u as G,r as m,j as e,R as $}from"./index-Dn-pTzZV.js";import{a as y}from"./index-C88pvD_q.js";import{r as a}from"./riyal_icon-CI4jK9IE.js";import{C as x}from"./Container-iQF6zWys.js";import{S as V}from"./Spinner-DK3UkTwu.js";import{A as v}from"./Alert-DZUHYfim.js";import{C as r}from"./Card-YgEBFH-O.js";import{B as w}from"./Button-A263VPWa.js";import{T as O}from"./Table-Br_0f40o.js";import{B as c}from"./ListGroup-CYDlwAD0.js";import"./hook-DLqGBdSw.js";import"./extends-CF3RwP-h.js";import"./divWithClassName-CuRTTgXn.js";import"./Anchor-7eg_kKsq.js";import"./useEventCallback-DtUHN23g.js";import"./Button-Dh52reoe.js";import"./CardHeaderContext-hP3UnztS.js";import"./Nav-C1m8REpO.js";import"./DataKey-COGXBUcQ.js";import"./NavContext-D5iJXFG-.js";import"./useMergedRefs-B9UIRkjd.js";import"./NavItem-CNWVUmZL.js";const he=()=>{const{id:l}=k(),N=G(),[j,b]=m.useState(null),[B,C]=m.useState(!0),[p,f]=m.useState("");m.useEffect(()=>{(async()=>{try{const s=await y.get(`http://185.199.53.88/api/invoice/${l}`);s.status===200&&b(s.data.data)}catch(s){console.error("Error fetching invoice:",s),f("Failed to fetch invoice details. Please try again.")}finally{C(!1)}})()},[l]);const T=async()=>{var t,s;try{const n=await y.get(`http://185.199.53.88/api/invoice/${l}/pdf`);if(!n.data.success)throw new Error(n.data.error||"Failed to generate PDF");const i=n.data.pdf,o=atob(i),g=new Uint8Array(o.length);for(let h=0;h<o.length;h++)g[h]=o.charCodeAt(h);const U=new Blob([g],{type:"application/pdf"}),u=window.URL.createObjectURL(U),d=document.createElement("a");d.href=u,d.download=`quotation_${j.invoiceNumber}.pdf`,document.body.appendChild(d),d.click(),d.remove(),window.URL.revokeObjectURL(u)}catch(n){console.error("Error generating PDF:",n),f(((s=(t=n.response)==null?void 0:t.data)==null?void 0:s.error)||"Failed to generate PDF. Please try again.")}},A=()=>{N(`/invoice/edit/${l}`)};if(B)return e.jsx(x,{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx(V,{animation:"border",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})})});if(p)return e.jsx(x,{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx(v,{variant:"danger",children:p})});if(!j)return e.jsx(x,{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx(v,{variant:"warning",children:"No invoice found."})});const{companyName:P,date:E,invoiceNumber:I,items:D,terms:F,totalPrice:L,VATAmount:S,finalAmount:R}=j,q=new Date(E).toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"});return e.jsx(x,{className:"my-5",children:e.jsxs(r,{children:[e.jsx(r.Header,{as:"h1",className:"text-center",children:"Invoice Details"}),e.jsxs(r.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-end mb-4",children:[e.jsx(w,{variant:"primary",onClick:A,className:"me-2",children:"Edit Invoice"}),e.jsx(w,{variant:"success",onClick:T,children:"Generate PDF"})]}),e.jsx(r,{className:"mb-4",children:e.jsxs(r.Body,{children:[e.jsxs(r.Title,{children:["Company: ",P]}),e.jsxs(r.Text,{children:[e.jsx("strong",{children:"Invoice Number:"})," ",I,e.jsx("br",{}),e.jsx("strong",{children:"Date:"})," ",q]})]})}),e.jsx(r,{className:"mb-4",children:e.jsxs(r.Body,{children:[e.jsx(r.Title,{children:"Items"}),e.jsxs(O,{striped:!0,bordered:!0,hover:!0,responsive:!0,children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Name"}),e.jsx("th",{children:"Quantity"}),e.jsx("th",{children:"Price"}),e.jsx("th",{children:"Total"}),e.jsx("th",{children:"Image"})]})}),e.jsx("tbody",{children:D.map((t,s)=>{const n=1+t.subItems.length;return e.jsxs($.Fragment,{children:[e.jsxs("tr",{children:[e.jsx("td",{children:t.name}),e.jsx("td",{className:"text-center",children:t.quantity}),e.jsxs("td",{className:"text-end flex flex-row",children:[e.jsx("img",{src:a,width:10,height:12}),t.price]}),e.jsxs("td",{className:"text-end flex flex-row",children:[e.jsx("img",{src:a,width:10,height:12}),t.quantity*t.price]}),e.jsx("td",{rowSpan:n,style:{textAlign:"center"},children:t.image&&e.jsx("img",{src:t.image,alt:t.name,style:{width:"80px",height:"auto"}})})]}),t.subItems.map((i,o)=>e.jsxs("tr",{children:[e.jsxs("td",{style:{paddingLeft:"30px"},children:[String.fromCharCode(97+o),"."," ",i.name]}),e.jsx("td",{className:"text-center",children:i.quantity}),e.jsxs("td",{className:"text-end flex flex-row",children:[e.jsx("img",{src:a,width:10,height:12}),i.price]}),e.jsxs("td",{className:"text-end flex flex-row",children:[e.jsx("img",{src:a,width:10,height:12}),i.quantity*i.price]})]},i._id))]},s)})})]})]})}),e.jsx(r,{className:"mb-4",children:e.jsxs(r.Body,{children:[e.jsx(r.Title,{children:"Totals"}),e.jsxs(c,{variant:"flush",children:[e.jsxs(c.Item,{children:[e.jsx("strong",{children:"Total Price:"})," ",e.jsx("img",{src:a,width:10,height:12}),L]}),e.jsxs(c.Item,{children:[e.jsx("strong",{children:"VAT Amount:"})," ",e.jsx("img",{src:a,width:10,height:12}),S]}),e.jsxs(c.Item,{children:[e.jsx("strong",{children:"Final Amount:"})," ",e.jsx("img",{src:a,width:10,height:12}),R]})]})]})}),e.jsx(r,{children:e.jsxs(r.Body,{children:[e.jsx(r.Title,{children:"Terms and Conditions"}),e.jsx(c,{variant:"flush",children:F.map((t,s)=>e.jsx(c.Item,{children:t},s))})]})})]})]})})};export{he as default};
