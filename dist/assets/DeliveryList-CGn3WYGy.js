import{b as F,u as L,r as i,j as e,T as H,e as y,L as f}from"./index-hhKMM5af.js";import{P as Q}from"./PageTitle-B1T6w3pI.js";import{S as C,b as S}from"./authConstant-D7ccvCuz.js";import{M as n}from"./Modal-BGqZktQ5.js";import{B as a}from"./Button-CwuV16Mp.js";import{R as v,C as m}from"./Row-D46S1-Yf.js";import{P as x}from"./Pagination-ehzOwloJ.js";import"./AbstractModalHeader-DFHrTKJL.js";import"./useWindow-BoBwgV2a.js";import"./usePrevious-B-65K_hW.js";import"./useEventCallback-3DrfGeCB.js";import"./hasClass-CxaWSnBi.js";import"./useMergedRefs-C_BGB1CU.js";import"./NoopTransition-ic9--HqH.js";import"./DataKey-COGXBUcQ.js";import"./divWithClassName-IzdvHqeb.js";import"./Button-Ccp68HYs.js";import"./Anchor-CDjO9hfG.js";const le=()=>{const{user:o}=F();L();const[b,w]=i.useState([]),[u,A]=i.useState(""),[r,T]=i.useState(1),[D,k]=i.useState(1),[E]=i.useState(10),[P,d]=i.useState(!1),[N,$]=i.useState(null),[p,c]=i.useState(!1),[R,j]=i.useState(!1),[B,M]=i.useState("");i.useEffect(()=>{o&&(async()=>{c(!0);try{const s=await fetch(`${S}/deliveries?page=${r}&limit=${E}&search=${u}`,{headers:{Authorization:`Bearer ${o.token}`}}),l=await s.json();s.ok&&l.success?(w(l.data),k(l.pagination.pages)):h("Failed to fetch deliveries.")}catch(s){console.error("Error fetching deliveries:",s),h(s.message||"Failed to fetch deliveries.")}finally{c(!1)}})()},[r,u,o]);const g=t=>{T(t)},_=t=>{$(t),d(!0)},z=async()=>{c(!0);try{const t=await fetch(`${S}/deliveries/${N}`,{method:"DELETE",headers:{Authorization:`Bearer ${o.token}`}}),s=await t.json();if(t.ok&&s.success)w(b.filter(l=>l._id!==N)),h("Delivery deleted successfully!");else throw new Error(s.error||"Failed to delete delivery.")}catch(t){console.error("Error deleting delivery:",t),h(t.message||"Failed to delete delivery.")}finally{c(!1),d(!1)}},h=t=>{M(t),j(!0),setTimeout(()=>j(!1),3e3)};return e.jsxs("div",{className:"d-flex p-4",children:[e.jsx(Q,{title:"Deliveries"}),e.jsx(H,{position:"top-end",className:"p-3",children:e.jsxs(y,{onClose:()=>j(!1),show:R,delay:3e3,autohide:!0,bg:"white",children:[e.jsx(y.Header,{children:e.jsx("strong",{className:"me-auto",children:"Notification"})}),e.jsx(y.Body,{children:B})]})}),e.jsxs(n,{show:P,onHide:()=>d(!1),children:[e.jsx(n.Header,{closeButton:!0,children:e.jsx(n.Title,{children:"Confirm Delete"})}),e.jsx(n.Body,{children:"Are you sure you want to delete this delivery note? This action cannot be undone."}),e.jsxs(n.Footer,{children:[e.jsx(a,{variant:"secondary",onClick:()=>d(!1),children:"Cancel"}),e.jsx(a,{variant:"danger",onClick:z,disabled:p,children:p?e.jsxs(e.Fragment,{children:[e.jsx(C,{as:"span",animation:"border",size:"sm",role:"status","aria-hidden":"true"})," ","Deleting..."]}):"Delete"})]})]}),e.jsx(v,{children:e.jsx(m,{xs:12,children:e.jsxs("div",{style:{width:"70vw",background:"white",border:"1px solid gray",padding:10,borderRadius:10},children:[e.jsxs(v,{className:"d-flex justify-content-between align-items-center p-2",children:[e.jsx(m,{xs:"auto",children:e.jsx("input",{type:"text",className:"form-control",placeholder:"Search by Company Name or Delivery Number",value:u,onChange:t=>A(t.target.value),style:{width:"250px",borderRadius:10}})}),e.jsx(m,{xs:"auto",children:e.jsx(a,{type:"button",variant:"dark",style:{padding:"10px 20px",borderRadius:10},as:f,to:"/delivery-note/new",children:"Create Delivery"})})]}),p?e.jsx("div",{className:"text-center",children:e.jsx(C,{animation:"border"})}):e.jsx("div",{children:e.jsx("div",{className:"responsive-table-plugin",children:e.jsx("div",{className:"table-rep-plugin",children:e.jsx("div",{className:"table-responsive","data-pattern":"priority-columns",children:e.jsxs("table",{id:"tech-companies-1",className:"table table-striped",style:{width:"100%",textAlign:"center"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"center"},children:"Company Name"}),e.jsx("th",{style:{textAlign:"center"},children:"Delivery Number"}),e.jsx("th",{style:{textAlign:"center"},children:"Date"}),e.jsx("th",{style:{textAlign:"center"},children:"Actions"})]})}),e.jsx("tbody",{children:b.map(t=>e.jsxs("tr",{children:[e.jsx("td",{style:{verticalAlign:"middle"},children:t.companyName}),e.jsx("td",{style:{verticalAlign:"middle"},children:t.deliveryNumber}),e.jsx("td",{style:{verticalAlign:"middle"},children:new Date(t.date).toLocaleDateString()}),e.jsxs("td",{style:{verticalAlign:"middle"},children:[e.jsx(a,{variant:"primary",size:"sm",as:f,to:`/delivery-note/view/${t._id}`,style:{marginRight:"5px"},children:"View"}),e.jsx(a,{variant:"info",size:"sm",as:f,to:`/delivery-note/edit/${t._id}`,style:{marginRight:"5px",color:"white"},children:"Edit"}),e.jsx(a,{variant:"danger",size:"sm",onClick:()=>_(t._id),children:"Delete"})]})]},t._id))})]})})})})}),e.jsx(v,{className:"mt-3",children:e.jsx(m,{xs:12,className:"d-flex justify-content-center",children:e.jsxs(x,{children:[e.jsx(x.Prev,{onClick:()=>g(r-1),disabled:r===1}),Array.from({length:D},(t,s)=>e.jsx(x.Item,{active:s+1===r,onClick:()=>g(s+1),children:s+1},s+1)),e.jsx(x.Next,{onClick:()=>g(r+1),disabled:r===D})]})})})]})})})]})};export{le as default};
